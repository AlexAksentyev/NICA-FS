INCLUDE 'bin/setups/SECOND-ST/SEQFULL';


PROCEDURE RUN;
  VARIABLE RESTMASSAMU 1; VARIABLE GAMMA 1; VARIABLE EKIN 1;
  VARIABLE WHERE 100;
  {LATTICE ARGUMENTS}
  VARIABLE KS 1 2; VARIABLE X  1 2; VARIABLE XS 1 2;
  {for TREL}
  VARIABLE MAPPARAMS 1 6; {HOLDS THE ABOVE VALUES}
  VARIABLE MAPARR 1000 6 547; VARIABLE SPNRARR 1000 3 3 547;
  VARIABLE VRF 1 1 1;
  VARIABLE FREQ 1;
  VARIABLE HNUM 1;

  VARIABLE I 1;

  EKIN := 1233;

  DIRSET WHERE 'data/ELEMENT_MAPS/SECOND-ST/'&MRK(EKIN)&'MeV/';
  
  OV 1 3 0;
  SET_FOR_PROTONS EKIN X XS;
  NAVIGATORS 3e-2 0 KS;
  
  MAPPARAMS(1) := X(1);   MAPPARAMS(2) := X(2);   {X}
  MAPPARAMS(3) := XS(1);  MAPPARAMS(4) := XS(2);  {XS}
  MAPPARAMS(5):= KS(1);  MAPPARAMS(6) := KS(2); {KS}

 LATTICE MAPPARAMS MAPARR SPNRARR;
  HNUM := 66;
  VRF(1, 1) := 100/HNUM; {RF Voltage [kV]}
  FREQ := HNUM*REVFREQ(ACCLEN(1)); {RF Frequency}
  UM; RF VRF 0 FREQ 0 0.05;
  { INSERT 1 MAPARR SPNRARR 546; }

    { OPENF 5315 WHERE&'ELEM_RF' 'REPLACE'; OPENF 5316 WHERE&'ELEM_RF-SPIN' 'REPLACE'; }
    {   UM;  RF VRF 0 FREQ 0 0.05; }
    {   WRITE 6 ' SYM ERROR = '&ST(SE(MAP)); }
    {   PM 5315; PSM 5316; }
    { CLOSEF 5315; CLOSEF 5316; }

  LOOP I 1 546;
    OPENF 5315 WHERE&'ELEM_'&MRK(I) 'REPLACE';{ OPENF 5316 WHERE&'ELEM_'&MRK(I)&'-SPIN' 'REPLACE';}
      LMAPS I MAPARR SPNRARR;
      WRITE 6 'ELEMENT '&MRK(I)&' SYM ERROR = '&ST(SE(MAP));
      PM 5315;{ PSM 5316;}
      { WRITE 5315 MAP(6); }
    CLOSEF 5315; CLOSEF 5316;
  ENDLOOP;
  
ENDPROCEDURE; {RUN}

RUN; END;
