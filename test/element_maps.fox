INCLUDE 'bin/setups/BENDS3/SEQFULL';


PROCEDURE RUN;
  VARIABLE RESTMASSAMU 1; VARIABLE GAMMA 1; VARIABLE EKIN 1;
  VARIABLE WHERE 100;
  VARIABLE QF  1; VARIABLE QD  1;
  VARIABLE HZ1 1; VARIABLE HZ2 1;
  VARIABLE KZ1 1; VARIABLE KZ2 1;
  VARIABLE MAPPARAMS 1 6; {HOLDS THE ABOVE VALUES}
  VARIABLE MAPARR 1000 6 615; VARIABLE SPNRARR 1000 3 3 615;
  VARIABLE KARR 1 2; VARIABLE NKARR 1;
  VARIABLE VRF 1 1 1;
  VARIABLE FREQ 1;
  VARIABLE HNUM 1;

  VARIABLE I 1;

  DIRSET WHERE 'data/ELEMENT_MAPS/';
  NKARR := 2;
  KARR(1) := 0;
  KARR(2) := 0.03;
  
  OV 1 3 0;
  SET_FOR_PROTONS HZ1 HZ2 QF QD;
  NAVIGATORS 1e-2 0 0 KZ1 KZ2;
  
  MAPPARAMS(1) := HZ1;     MAPPARAMS(2) := HZ2;
  MAPPARAMS(3) := KZ1*HZ1; MAPPARAMS(4) := KZ2*HZ2;
  MAPPARAMS(5) := QF;      MAPPARAMS(6) := QD;

  { IF TRUE; }
  { OPENF 5315 WHERE&'ELEM_OCT' 'REPLACE'; }
  {   UM; OCT .1 0 KARR(2)/.1; }
  {   PM 5315; }
  { CLOSEF 5315; }
  { ENDIF; }

  { WRITE 6 MAP(1) MAP(2) MAP(3) MAP(4) MAP(5) MAP(6); }

 LATTICE MAPPARAMS MAPARR SPNRARR;
  HNUM := 66;
  VRF(1, 1) := 100/HNUM; {RF Voltage [kV]}
  FREQ := HNUM*REVFREQ(ACCLEN(1)); {RF Frequency}
  { UM; RF VRF 0 FREQ 0 0.05; }
  { INSERT 1 MAPARR SPNRARR 614; }

  { OPENF 5315 WHERE&'ELEM_DL1' 'REPLACE'; }
  { UM; DL (2.625-0.35) ; PM 5315; }
  { CLOSEF 5315; }
  { OPENF 5315 WHERE&'ELEM_SOL2' 'REPLACE'; }
  { UM; SOLENOID .7 HZ1*(1+KZ1) ; PM 5315; }
  { CLOSEF 5315; }

  LOOP I 1 614;
    OPENF 5315 WHERE&'ELEM_'&MRK(I) 'REPLACE';
      LMAPS I MAPARR SPNRARR;
      WRITE 6 'ELEMENT '&MRK(I)&' SYM ERROR = '&ST(SE(MAP));
      PM 5315;
    CLOSEF 5315;
  ENDLOOP;
ENDPROCEDURE;

RUN; END;
