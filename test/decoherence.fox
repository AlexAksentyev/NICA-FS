INCLUDE 'bin/setups/BENDS24FULL';

PROCEDURE INJECT NUM;
  VARIABLE X 100; VARIABLE I 1;
  CR;
  X := LINSPACE(-1E-3, 1E-3, NUM);
  LOOP I 1 NUM;
    SR X|I 0 0 0 0 0 0 0 1; SSR 0 0 1;
    SR 0 0 X|I 0 0 0 0 0 1; SSR 0 0 1;
    SR 0 0 0 0 0 (X|I)/10 0 0 1; SSR 0 0 1;
  ENDLOOP;
ENDPROCEDURE;

PROCEDURE RUN;
  VARIABLE WHERE 100;
  VARIABLE QF  1; VARIABLE QD  1;
  VARIABLE HZ1 1; VARIABLE HZ2 1;
  VARIABLE KZ1 1; VARIABLE KZ2 1;
  VARIABLE RES 100; VARIABLE I 1; VARIABLE J 1;

  DIRSET WHERE 'data/DECOH/' TRUE;
  GROUTF 'img/dump/TR' 1;

  OV 5 3 0;
  SET_FOR_DEUTERONS HZ1 HZ2 QF QD;

  LATTICE HZ1 HZ2 KZ1 KZ2 QF QD 1;

  OPENF 100103 WHERE&'SPNR.map' 'REPLACE';
    LOOP I 1 3; RES := '';
      LOOP J 1 3;
        RES := RES&'     '&ST(CONS(SPNR(I, J)));
      ENDLOOP;
      WRITE 6 RES; WRITE 100103 RES;
    ENDLOOP;
  CLOSEF 100103;

  INJECT 30;
  
  OPENF 924 WHERE&'TRPRAY.dat' 'REPLACE';
  OPENF 925 WHERE&'TRPSPI.dat' 'REPLACE';
    TRPRAY 924; TRPSPI 925;
    TR 300000 1000 -1 -3 1.2 1.2 0 0 -12;
  CLOSEF 924; CLOSEF 925;
  
  WRITE 6 'SUCCESS!';

ENDPROCEDURE; {RUN}

RUN; END;

