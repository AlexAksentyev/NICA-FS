INCLUDE 'bin/setups/BYPASS/SEQFULL_SEX_CLEAR';

PROCEDURE READLENGTHS VAR;
  VARIABLE STRING 1000;

  OPENF 3838 'src/setups/BYPASS/FULL_SEX_CLEAR-element_lengths' 'OLD';
    READ 3838 STRING; CLOSEF 3838;
  WRITE 6 STRING;
ENDPROCEDURE;

PROCEDURE MAIN;
  VARIABLE WHERE 100;
  VARIABLE SF1 1; VARIABLE SF2 1; VARIABLE SD 1; VARIABLE EBE 1; VARIABLE BBE 1;
  VARIABLE MAPPARAMS 1 6; {HOLDS THE ABOVE VALUES}
  VARIABLE MAPARR 1000 6 536; VARIABLE SPNRARR 1000 3 3 536;

  VARIABLE DISPX0 1; VARIABLE DISPY0 1; VARIABLE DISPX0PR 1; VARIABLE DISPY0PR 1;
  VARIABLE AL0 1; VARIABLE BET0 1; VARIABLE GAM0 1;
  VARIABLE DISPXS 1 537; VARIABLE DISPYS 1 537;
  VARIABLE LENGTHS 1 536; {apparently holds element lengths}
  
  {SET MAP PARAMETERS}
    EBE := 100; {suboptimal value to get spin-tune 2e-4}
    BBE := 0;   {value irrelevant since R2 = R1 in WIEN:elements.fox}
    SF1 := 0.0475358;  {to}
    SF2 := SF1;        {be}
    SD := -0.0124713;  {reoptimized}
  MAPPARAMS(1) := SF1; MAPPARAMS(2) := SF2; MAPPARAMS(3) := SD;
  MAPPARAMS(4) := EBE; MAPPARAMS(5) := BBE;
  {-------}

  CLEAR_LENGTHS LENGTHS;

  DIRSET WHERE 'data/BYPASS/FULL_SEX_CLEAR/';
  GROUTF 'img/dump/TR' 1;
  
  OV 3 2 0; FR 0; {DAEPS 1E-12;}
  SET_FOR_DEUTERONS 1.1279235;
  LATTICE MAPPARAMS MAPARR SPNRARR;

  { GETTING DIPSERSION }
  GETDISP0 'X' DISPX0 DISPX0PR MAPARR SPNRARR;
  GETDISP0 'Y' DISPY0 DISPY0PR MAPARR SPNRARR;
  DISPS WHERE 'DISPX' 'X' 536 DISPX0 DISPX0PR DISPXS MAPARR SPNRARR LENGTHS;
  DISPS WHERE 'DISPY' 'Y' 536 DISPY0 DISPY0PR DISPYS MAPARR SPNRARR LENGTHS;
  {}



ENDPROCEDURE;

MAIN; END;
