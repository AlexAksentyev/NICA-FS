INCLUDE 'bin/setups/NICA_FS';

PROCEDURE RUN;
  VARIABLE WHERE 100;
  VARIABLE QF  1; VARIABLE QD  1;
  VARIABLE HZ1 1; VARIABLE HZ2 1;
  VARIABLE KZ1 1; VARIABLE KZ2 1;
  PROCEDURE INJECT NUM;
    VARIABLE X 100; VARIABLE I 1;
    X := LINSPACE(-1e-3, 1e-3, NUM);
    CR;
    LOOP I 1 NUM;
      SR X|I 0 0 0 0 0 0 0 1; SSR 0 0 0;
      SR 0 0 X|I 0 0 0 0 0 1; SSR 0 0 0;
    ENDLOOP;
  ENDPROCEDURE; {INJECT}
  PROCEDURE INJECT_SPIN NUM;
    VARIABLE I 1; VARIABLE SX 100; VARIABLE SY 100;
    SX := LINSPACE(-1, 1, NUM);
    SY := SQRT(1 - SX*SX);
    CR;
    LOOP I 1 NUM;
      SR 0 0 0 0 0 0 0 0 1; SSR SX|I SY|I 0;
    ENDLOOP;
  ENDPROCEDURE;


  DIRSET WHERE 'data/TEST/';
  GROUTF 'img/dump/TR' 1;

  OV 1 3 0;
  RP 270 1876.5592/AMUMEV 1;
  RPS 1 -.142987;

  CW_SETUP;

  INJECT_SPIN 10;
  TRACK 1000 1 WHERE '';
  
  WRITE 6 'SUCCESS!';

ENDPROCEDURE; {RUN}

RUN; END;

