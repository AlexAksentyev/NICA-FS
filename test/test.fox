INCLUDE 'bin/setups/BENDS24/FULL';

PROCEDURE INJECT;
  CR;
  SR 1E-3 0 0 0 0 0 0 0 1; SSR 0 0 1;
  SR 0 0 1E-3 0 0 0 0 0 1; SSR 0 0 1;
  SR .5E-3 0 0 0 0 0 0 0 1; SSR 0 0 1;
  SR 0 0 .5E-3 0 0 0 0 0 1; SSR 0 0 1;
ENDPROCEDURE;

PROCEDURE SEPSEARCH_INJECT LOW HIGH NUM; {INJECT TO SEARCH FOR SEPARATRIX}
  VARIABLE D 500; VARIABLE I 1;
  D := LINSPACE(LOW, HIGH, NUM);
  CR;
  LOOP I 1 NUM;
    SR 0 0 0 0 0 (D|I) 0 0 1; SSR 0 0 1;
  ENDLOOP;
ENDPROCEDURE;
PROCEDURE SEPSEARCH_INJECT1 LOW HIGH NUM; {INJECT TO SEARCH FOR SEPARATRIX}
  VARIABLE L 500; VARIABLE I 1;
  L := LINSPACE(LOW, HIGH, NUM);
  CR;
  LOOP I 1 NUM;
    SR 0 0 0 0 (L|I) 0 0 0 1; SSR 0 0 1;
  ENDLOOP;
ENDPROCEDURE;

PROCEDURE RUN;
  VARIABLE WHERE 100;
  VARIABLE QF  1; VARIABLE QD  1;
  VARIABLE HZ1 1; VARIABLE HZ2 1;
  VARIABLE KZ1 1; VARIABLE KZ2 1;
  VARIABLE MAPARR 1000 6 471; VARIABLE SPNRARR 1000 3 3 471; 

  DIRSET WHERE 'data/TEST/' TRUE;
  GROUTF 'img/dump/TR' 1;

  OV 3 3 0;
  SET_FOR_DEUTERONS HZ1 HZ2 QF QD;
  SEPSEARCH_INJECT1 5 20 10;
  

  LATTICE HZ1 HZ2 KZ1 KZ2 QF QD 1;
  OPENF 9230 WHERE&'BENDS24FULL.map' 'REPLACE';
    PM 9230;
  CLOSEF 9230;
  
  OPENF 924 WHERE&'TRPRAY.dat' 'REPLACE';
  OPENF 925 WHERE&'TRPSPI.dat' 'REPLACE';
    TRPRAY 924; TRPSPI 925;
    TR 50000 500 5 6 1.2e1 1.2e-2 0 0 -12;
  CLOSEF 924; CLOSEF 925;
  
  WRITE 6 'SUCCESS!';

ENDPROCEDURE; {RUN}

RUN; END;

